# HospitalGeneratorRDF

**_HospitalGeneratorRDF_** is a program that based on the output of [_H-Outbreak_](https://github.com/denissekim/Simulation-Model), a simulation model of the movements of patients inside a hospital, creates a knowledge graph in RDF and RDF* according to a data model that is an extension to the used in [_MimicToRDF_](https://github.com/LorenaPujante/MimicToRDF). It also generates CSV files to allow the use of the data for other purposes and structures. This software has been used in the work "_Spatiotemporal Data Modelling for Epidemiological Research in Hospitals_" with DOI [10.1109/JBHI.2024.3417224](https://ieeexplore.ieee.org/document/10568325) 

Since H-Outbreak does not cover all the classes and relations from the data model, HospitalGeneratorRDF completes it by adding _Floors_, _Areas_, _Corridors_, _Rooms_, _Beds_, _Services_ (in H-Outbreak they are wards) and _Hospitalization Units_, and the relations between them. It also creates different subclasses of _Events_: _Hospitalization_, _Radiology_, _Surgery_ and _Death_.
- The file [_Description/HospitalGeneratorRDF - Description.pdf_](https://github.com/LorenaPujante/HospitalGeneratorRDF/blob/main/Description/HospitalGeneratorRDF%20-%20Description.pdf) describes the complete process to create the hospital layout data.

## 0. Related Repositories
Here, we present some other related repositories that may be of your interest:
- [**HospitalKG**](https://github.com/LorenaPujante/HospitalKG): It is also linked to [10.1109/JBHI.2024.3417224](https://ieeexplore.ieee.org/document/10568325)
- [**HospitalGeneratorRDF_V2**](https://github.com/LorenaPujante/HospitalGeneratorRDF_V2): A slightly updated version of this software

## 1. Installation
The source code is currently hosted on [github.com/LorenaPujante/HospitalGeneratorRDF](https://github.com/LorenaPujante/HospitalGeneratorRDF).

The program is in Python 3.10, and no external packages are needed.

## 2. Input
The input for HospitalGeneratorRDF must be: 
- The two files obtained as output from H-Outbreak: _movements.csv_ and _patients.csv_
- An additional file with the hospital layout from H-Outbreak: _hospital.txt_.
	- To get this file, we need to modify the file _hospital.py_ from H-Outbreak by adding the `printHospital()` function from [_Modifications/modification.py_](https://github.com/LorenaPujante/HospitalGeneratorRDF/blob/main/Modifications/modification.py). Then, call the new function at the end of `initialize_hospital()`, just before the `return L`.     
These three files must be in folder _Input_.

## 3. Execution and Configuration Params
To run the program, in the terminal, go to the folder containing the program and run: `python main.py`

The main function receives as parameters the following:
- _index_: Index to start numbering (property _id_) the objects that are created to complete the hospital layout. It is recommended that this index be greater than the last _id_ of the elements in the H-Outrbreak hospital layout.
- _huPerService_: Number of HospitalizationUnits to create per Service.
- _nFloors_: Number of Floors that the hospital will have. This number must be greater or equal to 2.
- _huPerFloor_: Number of HospitalizationUnits that each Floor (except the ground floor) will have.
- _nRows_, _nColumns_: Number of rows and columns that the grill that divides each Floor (except the ground floor) will have.
- _startDateTime_: Date and time of the first step from the simulation generated by H-Outbreak. The next steps will be dated from this parameter.
- _optionFloorHU_: When it is not possible to create a suitable hospital layout that has the specified number of HospUnits per Floor, with this parameter, we select if we want to keep the number of HospUnits per Floor and modify `nFloors` (option `1`) or to keep the number of Floors and modify `huPerFloor` (option `2`). If this parameter is `None`, then the option will be asked by terminal.

The `main()` function also has commented function calls to request these parameters per terminal.

At the end of _main.py_, before the call to `main()` function, we have set some example values for the parameters. We have also uploaded three example input files in _Input_. The output files are also uploaded.
- In the example, the hospital will have 4 Floors. On the ground floor, there will be 20 Emergency beds, 10 ICU beds, 3 surgery rooms, and 4 radiology rooms with 2 beds each. In the remaining 3 floors, 8 services will be distributed. Each service will have 2 hospitalization units and between 10 and 14 rooms. Each room will have 2 beds. Each floor will have 5 hospitalization units. The 3 upper floors will be organised in a grid of 3 columns by 2 rows. (These 3 last values may change during program execution)
- The initial date will be _01/01/23 08:00:00_


## 4. Outcomes
After running the program, the following folders are created:
- _OutputCSV_: Folder with the nodes and edges of the graph in the form of CSV files.
	- Nodes and edges are in different folders: `OutputCSV/Classes` (nodes) and `OutputCSV/CSV` (edges). Each class of nodes and edges is in a separate file.
- _OutputRDF_: Folder with the nodes and edges of the RDF knowledge graph in the form of N-Triples files.
	- Nodes and edges are in different folders: `OutputRDF/Classes` (nodes) and `OutputRDF/CSV` (edges). Each class of nodes and edges is in a separate file. Inside each folder, there also is a file with the union of all the nodes (`OutputRDF/Classes/Classes_complete.nt`) and the union of all the edges (`OutputRDF/Relations/Relations_complete.nt`), respectively. Finally, the file `OutputRDF/data_complete.*.nt` contains the nodes and edges' union.
- _OutputRDF_star_: Folder with the nodes and edges of the RDF* knowledge graph in the form of N-Triples files (nodes) and Turtle files (edges).
	- Nodes and edges are in different folders: `OutputRDF_star/Classes` (nodes) and `OutputRDF_star/CSV` (edges). Each class of nodes and edges is in a separate file. Inside each folder, there also is a file with the union of all the nodes (`/Classes.*/Classes_complete.nt`) and the union of all the edges (`OutputRDF_star/Relations.*/Relations_complete.ttl`), respectively. Finally, the file `OutputRDF_star/data_complete.ttl` contains the nodes and edges' union.
- _OutputSummary_: Folder with two summary files:
  - _EpisodeSummary.txt_: This file shows for each patients how many Episodes and Events with their _description_, _id_ and _start_ and _end dates_. For Events, it also shows their subclass and to which Bed they are connected.
  - _HospitalSummary.txt_: This file shows a list with all the Services, HopitalizationUnits and Locations of the hospital. For each element, it presents its id, description and several lists with all the other elements of the spatial dimmension to which it is connected.     

Repeated runs will replace existing files.
